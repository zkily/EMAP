# 权限管理系统测试指南

## 概述

本文档介绍如何使用样本数据来测试权限管理系统的各项功能。系统提供了完整的权限管理功能，包括角色权限、页面权限、用户特殊权限、权限模板等。

## 快速开始

### 1. 插入样本数据

```bash
# 进入后端目录
cd backend

# 运行样本数据插入脚本
node sample-data/permission-sample-data.js insert
```

### 2. 启动系统

```bash
# 启动后端服务
npm run dev

# 启动前端服务（新终端）
cd ../frontend
npm run dev
```

### 3. 访问权限管理页面

打开浏览器访问：`http://localhost:3000/system/permissions`

## 测试账户

样本数据包含以下测试账户：

| 用户名   | 密码     | 角色         | 特殊权限          | 说明                        |
| -------- | -------- | ------------ | ----------------- | --------------------------- |
| admin    | password | 管理者       | 所有权限          | 系统管理员，拥有全部功能    |
| manager1 | password | マネージャー | +系统设置权限     | 经理级别 + 部门系统管理权限 |
| manager2 | password | マネージャー | 无                | 标准经理权限                |
| user1    | password | 一般ユーザー | +数据导出权限     | 普通用户 + 报表制作权限     |
| user2    | password | 一般ユーザー | +临时订单删除权限 | 普通用户 + 30天临时删除权限 |
| user3    | password | 一般ユーザー | +临时计划优化权限 | 普通用户 + 60天临时优化权限 |
| guest1   | password | ゲスト       | 无                | 只读访问权限                |

## 功能测试场景

### 1. 角色权限管理测试

#### 测试步骤：

1. 使用 `admin` 账户登录
2. 进入权限管理页面
3. 切换不同角色标签页
4. 观察不同角色的权限配置
5. 尝试修改权限并保存

#### 预期结果：

- 管理员拥有所有权限
- 经理拥有大部分业务权限，但没有系统管理权限
- 普通用户只有基本的查看和创建权限
- 访客只有查看权限

### 2. 页面权限管理测试

#### 测试步骤：

1. 切换到"ページ権限管理"标签页
2. 查看不同模块的页面权限配置
3. 修改某个页面的必要权限
4. 保存更改

#### 预期结果：

- 显示按模块分组的页面列表
- 可以为每个页面设置所需权限
- 支持批量保存修改

### 3. 用户特殊权限测试

#### 测试步骤：

1. 切换到"ユーザー特別権限"标签页
2. 选择不同用户查看其特殊权限
3. 为用户添加新的特殊权限
4. 设置权限过期时间和授权理由
5. 撤回某个用户的特殊权限

#### 预期结果：

- user1 有数据导出的额外权限
- user2 有临时的订单删除权限（30天后过期）
- user3 有临时的计划优化权限（60天后过期）
- manager1 有系统设置的额外权限

### 4. 权限模板管理测试

#### 测试步骤：

1. 切换到"権限テンプレート"标签页
2. 查看预设的权限模板
3. 创建新的权限模板
4. 应用模板到某个角色
5. 编辑和删除模板

#### 预期结果：

- 显示5个预设模板（受注管理者、生产计划担当者等）
- 可以创建自定义权限组合模板
- 支持将模板应用到角色

### 5. 权限统计查看

#### 测试步骤：

1. 切换到"権限統計"标签页
2. 查看权限使用统计
3. 观察角色权限分布
4. 查看权限使用频率排行

#### 预期结果：

- 显示特殊权限用户数量
- 显示总特殊权限数
- 显示角色权限分布图表
- 显示权限使用频率统计

## 权限验证测试

### 1. 不同角色登录测试

分别使用不同角色的账户登录，验证：

- 能否访问权限管理页面
- 能否看到相应的功能模块
- 能否执行相应的操作

### 2. 特殊权限验证

使用有特殊权限的用户账户：

- 验证额外权限是否生效
- 验证临时权限的过期机制
- 验证权限撤回后的效果

## 数据结构说明

### 权限代码规范

权限代码采用 `模块:操作` 的格式：

- `order:*` - 订单管理相关权限
- `plan:*` - 生产计划相关权限
- `shipping:*` - 出货管理相关权限
- `system:*` - 系统管理相关权限
- `data:*` - 数据操作相关权限
- `page:*` - 页面访问相关权限
- `admin:*` - 管理员功能相关权限

### 模块分组

页面权限按以下模块分组：

- `order` - 受注管理
- `plan` - 生産計画
- `shipping` - 出荷管理
- `system` - システム管理
- `staff` - 人員管理
- `master` - マスタ管理

## 清理测试数据

测试完成后，可以清理样本数据：

```bash
node sample-data/permission-sample-data.js clear
```

**注意：** 此操作会删除所有样本数据，包括用户账户和权限配置，请谨慎使用。

## 常见问题

### Q: 登录时提示账户不存在？

A: 确保已经运行了样本数据插入脚本，并且数据库连接正常。

### Q: 权限修改后没有生效？

A: 检查是否点击了保存按钮，并且确认没有权限验证错误。

### Q: 无法访问权限管理页面？

A: 确保使用的是管理员账户，或者有相应的系统管理权限。

### Q: 特殊权限显示为空？

A: 确保选择了正确的用户，并且该用户确实有特殊权限配置。

## 扩展测试

可以基于样本数据进行以下扩展测试：

1. **批量权限操作** - 测试全选、全不选、按组选择等功能
2. **权限继承** - 测试角色权限与特殊权限的组合效果
3. **权限过期** - 修改数据库中的过期时间来测试过期权限的处理
4. **权限模板应用** - 测试模板应用对现有权限的影响
5. **权限统计准确性** - 验证统计数据与实际权限配置的一致性

通过这些测试场景，可以全面验证权限管理系统的功能完整性和数据准确性。
