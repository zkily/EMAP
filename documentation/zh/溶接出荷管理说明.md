# 溶接出荷管理功能说明

## 概要

溶接出荷管理功能从`shipping_items`表中筛选溶接相关产品，按指定期间生成二维表格，并支持打印输出。

## 功能特点

### 1. 智能产品筛选

- 自动从数据库中识别溶接相关产品
- 支持多种溶接产品关键词匹配：
  - 日文：`溶接`、`ヨウセツ`
  - 英文：`welding`、`WELDING`

### 2. 灵活的期间查询

- 支持自定义日期范围查询
- 提供便捷的日期快捷选项：
  - 今月
  - 先月
  - 过去7日
  - 过去30日

### 3. 多维度数据展示

- **按产品分类**：每个溶接产品独立表格显示
- **按纳入先分组**：横向展示各纳入先的出荷数据
- **按日期排列**：时间序列展示出荷趋势
- **数量统计**：同时显示出荷数量（本）和箱数

### 4. 完整的统计功能

- **日计合计**：每日所有纳入先的出荷总计
- **纳入先合计**：每个纳入先的期间出荷总计
- **产品合计**：单个产品的期间出荷总计
- **全体合计**：所有产品的期间出荷总计

### 5. 专业打印输出

- A4横向打印优化布局
- 专业的表格样式设计
- 自动生成打印标题和期间信息
- 支持浏览器打印功能

## 技术实现

### 后端API

```
GET /api/shipping/welding/products     # 获取溶接产品列表
GET /api/shipping/welding/data         # 获取溶接出荷数据
POST /api/shipping/welding/export      # 导出打印报告
```

### 前端页面

- 路径：`/shipping/welding`
- 菜单：出荷管理 → 溶接出荷管理

### 数据库查询

```sql
SELECT
  shipping_date,
  destination_name,
  product_name,
  SUM(confirmed_units) as total_units,
  SUM(confirmed_boxes) as total_boxes,
  COUNT(*) as shipping_count
FROM shipping_items
WHERE shipping_date BETWEEN ? AND ?
  AND product_name IN (选择的产品列表)
  AND status != 'キャンセル'
GROUP BY shipping_date, destination_name, product_name
ORDER BY shipping_date ASC, destination_name ASC, product_name ASC
```

## 使用方法

### 1. 访问页面

在主菜单中选择「出荷管理」→「溶接出荷管理」

### 2. 设置查询条件

- **期间选择**：设置查询的开始日期和结束日期
- **产品选择**：从下拉列表中选择需要分析的溶接产品（支持多选）

### 3. 执行查询

点击「検索」按钮执行数据查询

### 4. 查看结果

- 页面显示统计概要信息
- 每个产品显示独立的二维表格
- 表格包含日期×纳入先的交叉数据
- 自动计算各种合计数据

### 5. 打印输出

点击「印刷用出力」按钮生成打印用报告，在新窗口中打开可直接打印

## 表格说明

### 数据单元格格式

```
数量(本)
箱数
```

- 上行：出荷数量（単位：本）
- 下行：出荷箱数

### 颜色标识

- **红色数字**：出荷数量
- **蓝色数字**：出荷箱数
- **黄色背景**：合计行
- **绿色标题**：产品名称

### 合计说明

- **行合计**：各纳入先在整个期间的出荷总计
- **列合计（日計）**：各日期所有纳入先的出荷总计
- **总合计**：整个期间、所有纳入先、单个产品的出荷总计

## 示例数据

系统提供了示例测试数据，包含以下溶接产品：

- 溶接ロッド 3.2mm
- アルミ溶接ワイヤ
- ステンレス溶接棒
- WELDING ELECTRODE
- チタン溶接材料

## 权限要求

- 角色权限：admin、manager、staff
- 功能权限：shipping:view

## 注意事项

1. **数据筛选**：只显示状态不为「キャンセル」的出荷记录
2. **产品识别**：基于产品名称的关键词匹配来识别溶接产品
3. **日期范围**：建议查询期间不要过长，以保证表格的可读性
4. **打印优化**：报告专为A4横向打印设计，确保最佳打印效果

## 扩展性

该功能框架具有良好的扩展性，可以轻松适配其他产品类型的出荷管理：

- 修改产品筛选条件
- 调整表格布局
- 增加新的统计维度
- 扩展导出格式
