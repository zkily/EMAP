# 权限管理系统使用指南

## 📋 目录

1. [系统概述](#系统概述)
2. [样本数据](#样本数据)
3. [快速开始](#快速开始)
4. [功能详解](#功能详解)
5. [实际使用场景](#实际使用场景)
6. [常见问题](#常见问题)
7. [最佳实践](#最佳实践)

## 🎯 系统概述

Smart-EMAP权限管理系统是一个基于角色的访问控制（RBAC）系统，支持：

- **4种预设角色**：admin（管理者）、manager（マネージャー）、user（一般ユーザー）、guest（ゲスト）
- **多层权限控制**：页面访问、功能操作、数据操作、管理功能
- **灵活权限分配**：角色权限、用户特殊权限、权限模板
- **完整审计跟踪**：权限变更记录、使用统计

## 📊 样本数据

### 测试用户账户

| 用户名      | 密码         | 角色         | 姓名           | 说明                     |
| ----------- | ------------ | ------------ | -------------- | ------------------------ |
| `admin`     | `admin123`   | 管理者       | システム管理者 | 系统管理员，拥有所有权限 |
| `manager01` | `manager123` | マネージャー | 田中太郎       | 部门经理，拥有管理权限   |
| `user01`    | `user123`    | 一般ユーザー | 佐藤花子       | 普通用户，基本操作权限   |
| `guest01`   | `guest123`   | ゲスト       | 山田次郎       | 访客用户，只读权限       |

### 权限类型说明

#### 页面访问权限 (page:\*)

- `page:order` - 受注管理页面
- `page:plan` - 生産計画页面
- `page:shipping` - 出荷管理页面
- `page:staff` - 人員管理页面
- `page:system` - システム管理页面
- `page:master` - マスタ管理页面

#### 功能操作权限

- `order:*` - 受注相关操作（view, create, edit, delete）
- `plan:*` - 生産計画相关操作
- `shipping:*` - 出荷相关操作

#### 数据操作权限 (data:\*)

- `data:read` - 数据读取
- `data:create` - 数据创建
- `data:update` - 数据更新
- `data:delete` - 数据删除
- `data:export` - 数据导出
- `data:import` - 数据导入

#### 管理功能权限 (admin:\*)

- `admin:user-manage` - 用户管理
- `admin:role-manage` - 角色管理
- `admin:permission-manage` - 权限管理
- `admin:system-config` - 系统设置

### 预设权限模板

1. **基本受注権限** - 受注管理基本权限组合
2. **生産管理権限** - 生产计划管理权限组合
3. **出荷管理権限** - 出荷业务权限组合
4. **マネージャー権限** - 部门经理权限组合
5. **システム管理権限** - 系统管理权限组合

## 🚀 快速开始

### 1. 初始化样本数据

```bash
# 进入后端目录
cd backend

# 运行样本数据脚本
node sample-data.js
```

### 2. 启动系统

```bash
# 启动后端服务
cd backend
npm run dev

# 启动前端服务
cd frontend
npm run dev
```

### 3. 访问权限管理

1. 使用管理员账户登录：`admin` / `admin123`
2. 访问权限管理页面：`/system/permission`
3. 开始配置权限

## 🔧 功能详解

### 1. 角色权限管理

#### 访问路径

权限管理 → ロール権限管理

#### 操作步骤

1. **选择角色**

   - 点击角色标签页（admin、manager、user、guest）
   - 系统自动加载该角色的当前权限

2. **权限配置**

   - 权限按类型分组显示（受注管理、生産計画等）
   - 使用复选框选择/取消权限
   - 支持全选、全取消、按组选择

3. **批量操作**

   - 全選択：选择所有权限
   - 全解除：取消所有权限
   - グループ選択：选择整个权限组
   - グループ解除：取消整个权限组

4. **保存配置**
   - 点击"権限を保存"按钮
   - 系统显示保存进度和结果

#### 实际示例

**为manager角色添加受注管理权限：**

1. 选择"マネージャー"标签页
2. 在"受注管理"分组中勾选：
   - `page:order` - 页面访问
   - `order:view` - 查看受注
   - `order:create` - 创建受注
   - `order:edit` - 编辑受注
3. 点击保存按钮

### 2. 页面权限管理

#### 访问路径

权限管理 → ページ権限管理

#### 功能说明

为系统中的每个页面设置访问所需的权限。

#### 操作步骤

1. **选择模块**

   - 点击模块标签页（order、plan、shipping等）
   - 查看该模块下的所有页面

2. **设置权限**

   - 为每个页面选择"必要権限"
   - 可以设置为特定权限或留空（无限制）

3. **编辑页面信息**

   - 点击"編集"按钮修改页面描述
   - 更新页面的详细说明

4. **批量保存**
   - 修改后点击"ページ権限を保存"
   - 系统显示待保存的变更数量

#### 实际示例

**设置受注検索页面权限：**

1. 选择"order"模块标签页
2. 找到"受注検索"页面
3. 在"必要権限"下拉框中选择`order:view`
4. 点击保存按钮

### 3. 用户特殊权限

#### 访问路径

权限管理 → ユーザー特別権限

#### 功能说明

为特定用户临时或永久添加超出其角色权限的特殊权限。

#### 操作步骤

1. **选择用户**

   - 在用户选择器中选择目标用户
   - 系统显示用户的角色信息

2. **查看现有权限**

   - 自动加载用户的特殊权限列表
   - 显示权限详情、过期时间、授权理由

3. **添加新权限**

   - 点击"権限追加"按钮
   - 选择要添加的权限（支持多选）
   - 填写授权理由
   - 设置过期时间（可选）

4. **撤销权限**
   - 在权限列表中点击"撤回"按钮
   - 确认撤销操作

#### 实际示例

**给user01临时添加数据导出权限：**

1. 选择用户"user01 (佐藤花子)"
2. 点击"権限追加"按钮
3. 在权限选择中勾选`data:export`
4. 填写理由："月末レポート作成のため"
5. 设置过期时间：30天后
6. 点击"権限追加"确认

### 4. 权限模板管理

#### 访问路径

权限管理 → 権限テンプレート

#### 功能说明

创建权限组合模板，便于快速为角色分配权限。

#### 操作步骤

1. **创建模板**

   - 点击"新規テンプレート作成"
   - 填写模板名称和描述
   - 选择权限组合
   - 保存模板

2. **编辑模板**

   - 点击模板行的"編集"按钮
   - 修改模板信息和权限组合
   - 保存更改

3. **应用模板**

   - 点击"適用"按钮
   - 选择目标角色
   - 确认应用操作

4. **删除模板**
   - 点击"削除"按钮
   - 确认删除操作

#### 实际示例

**创建"営業担当者権限"模板：**

1. 点击"新規テンプレート作成"
2. 填写信息：
   - 名称："営業担当者権限"
   - 描述："営業部門の担当者向け権限セット"
3. 选择权限：
   - `page:order`, `order:view`, `order:create`
   - `data:read`, `data:export`
4. 保存模板
5. 将模板应用到"user"角色

### 5. 权限统计

#### 访问路径

权限管理 → 権限統計

#### 功能说明

查看系统权限使用统计和分析数据。

#### 统计内容

1. **概览统计卡片**

   - 特別権限ユーザー数
   - 総特別権限数
   - 総権限数

2. **角色权限分布**

   - 各角色拥有的权限数量
   - 权限覆盖率可视化

3. **权限使用频率**
   - 最常用的权限TOP10
   - 权限在角色和用户中的使用情况

## 💼 实际使用场景

### 场景1：新员工入职

**需求**：为新入职的営業担当者设置权限

**操作步骤**：

1. 使用"営業担当者権限"模板为user角色配置基础权限
2. 根据具体职责，为用户添加特殊权限（如特定客户数据访问）
3. 设置权限过期时间（试用期结束时间）

### 场景2：临时项目权限

**需求**：为项目临时授权数据导出权限

**操作步骤**：

1. 选择项目成员用户
2. 添加`data:export`权限
3. 设置过期时间为项目结束时间
4. 填写授权理由："プロジェクト用データ分析"

### 场景3：部门权限重组

**需求**：调整部门权限结构

**操作步骤**：

1. 创建新的权限模板（如"新営業部権限"）
2. 将模板应用到相关角色
3. 清理不再需要的用户特殊权限
4. 检查权限统计确认变更效果

### 场景4：系统维护权限

**需求**：临时授权系统维护权限

**操作步骤**：

1. 为技术人员添加`admin:system-config`权限
2. 设置短期过期时间（如24小时）
3. 填写详细的授权理由
4. 维护完成后确认权限已自动过期

## ❓ 常见问题

### Q1：权限修改后多久生效？

**A**：权限修改立即生效，用户下次请求时会重新验证权限。建议用户重新登录以确保权限更新。

### Q2：如何批量管理多个用户的权限？

**A**：可以通过以下方式：

1. 使用权限模板批量应用到角色
2. 调整角色权限影响该角色的所有用户
3. 对于特殊情况，需要逐个用户设置

### Q3：权限过期后会发生什么？

**A**：

- 过期的特殊权限自动失效
- 用户恢复到角色基础权限
- 系统会在权限统计中标识过期权限

### Q4：如何查看权限变更历史？

**A**：当前版本在统计页面显示基本信息，详细的审计日志功能在后续版本中提供。

### Q5：误删权限如何恢复？

**A**：

1. 通过权限模板快速恢复角色权限
2. 重新为用户添加特殊权限
3. 建议定期备份权限配置

## 🏆 最佳实践

### 1. 权限设计原则

**最小权限原则**

- 用户只获得完成工作所需的最少权限
- 定期审查和清理不必要的权限

**职责分离**

- 敏感操作需要多个权限组合
- 避免单一用户拥有过多权限

**权限分层**

- 基础权限通过角色分配
- 特殊需求通过用户权限补充
- 临时权限设置合理的过期时间

### 2. 权限管理流程

**权限申请流程**

1. 用户提交权限申请（包含理由和期限）
2. 部门经理审核批准
3. 系统管理员配置权限
4. 定期审查权限使用情况

**权限审计流程**

1. 月度权限使用统计分析
2. 季度权限配置审查
3. 年度权限体系优化

### 3. 安全建议

**账户安全**

- 定期更换管理员密码
- 启用双因素认证（如果支持）
- 监控异常登录活动

**权限监控**

- 关注权限统计异常
- 及时处理过期权限
- 记录重要权限变更

**备份恢复**

- 定期备份权限配置
- 测试权限恢复流程
- 建立权限变更回滚机制

### 4. 性能优化

**大量用户管理**

- 合理使用角色权限减少特殊权限数量
- 定期清理过期和无效权限
- 优化权限查询和验证逻辑

**权限缓存**

- 系统会缓存用户权限信息
- 权限变更后建议用户重新登录
- 监控缓存命中率和性能

## 📞 技术支持

如果在使用过程中遇到问题，请：

1. 查阅本使用指南
2. 检查系统日志和错误信息
3. 联系系统管理员或技术支持团队

---

**版本**：v1.0  
**更新时间**：2024年12月  
**适用系统**：Smart-EMAP v1.0+
